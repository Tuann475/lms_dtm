<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="image/logo.ico">
    <!-- Bootstrap & libs (same as other teacher pages) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
    <link href='https://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet'>
    <!-- Single jQuery include to avoid conflicts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.2/js/toastr.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.2/js/dataTables.bootstrap5.min.js"></script>
    <link href="https://cdn.datatables.net/1.13.2/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <!-- Use admin style to match gray-white-gray frame -->
    <link rel="stylesheet" href="/admin/css/style.css">
    <script src="/teacher/js/main.js"></script>
    <script src="/js/teacher_exam_list.js"></script>
    <style>
        /* Prevent table overlapping nav: fix nav width and offset content */
        .navleft { width: 200px; padding: 8px 10px; }
        .listmenumain a { display: block; white-space: nowrap; padding: 6px 10px; }
        .contentweb { margin-left: 200px; }
        /* Truncate long course text in the table */
        .col-course { max-width: none !important; overflow: visible !important; white-space: normal !important; }
        #examTable { table-layout: fixed; }
        #examTable td .course-text { white-space: normal !important; overflow: visible !important; text-overflow: clip !important; }
        /* Match action buttons font size to other columns */
        .col-actions .btn { font-size: inherit; line-height: 1.5; }
        /* Make Khóa học column wrap like admin */
        #examTable.table { table-layout: fixed; }
        #examTable thead th:nth-child(6), #examTable tbody td:nth-child(6) {
            white-space: normal;
            word-break: break-word;
        }
        /* Khôi phục width cho cột Chức năng */
        #examTable th.sticky-col, #examTable td.sticky-col { width:120px; min-width:120px; max-width:120px; }
        /* Gỡ đường gạch ngang dưới header và phần Xin chào nếu không mong muốn */
        .headerweb { border-bottom: none !important; box-shadow: none !important; }
        .navleft .divroot { border-bottom: none !important; }
        /* Nếu vẫn thấy đường kẻ từ .headertable thì có thể bỏ luôn */
        .headertable { border-bottom: none !important; }
    </style>
    <script>
        // Init filter + data once on ready
        $(function(){
            if(typeof loadCourseFilter === 'function'){ loadCourseFilter(); }
            if(typeof loadTeacherExams === 'function'){ loadTeacherExams(); }
        });
    </script>
</head>
<body>
<div class="navleft" id="navleft"></div>
<div class="contentweb">
    <div class="headerweb" id="headerweb"></div>
    <div class="contentmain">
        <!-- Top gray header section to match admin (controls only) -->
        <div class="col-sm-12 header-sp">
            <div class="row">
                <div class="col-md-6">
                    <!-- Removed page title -->
                </div>
                <div class="col-md-3 col-sm-6 col-6">
                    <!-- Removed reload button -->
                </div>
                <div class="col-md-3 col-sm-6 col-6">
                    <label for="khoahocbaithi" class="lb-form">Khóa học</label>
                    <div class="d-flex align-items-center gap-2">
                        <select id="khoahocbaithi" class="form-control"></select>
                        <span id="courseSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display:none"></span>
                    </div>
                </div>
            </div>
        </div>
        <!-- White content with table -->
        <div class="tablediv">
            <div class="headertable d-flex justify-content-between align-items-center mb-2">
                <!-- Nút thêm bài thi -->
                <a href="addbaithi" class="btn btn-success">
                    <i class="fa fa-plus"></i> Thêm bài thi
                </a>
                <!-- ...existing code (có thể có các nút khác)... -->
            </div>
            <div class="col-sm-12">
                <div class="wrapper">
                    <!-- Renamed table id from example to examTable for DataTables init alignment -->
                    <table id="examTable" class="table table-striped tablefix">
                        <thead class="thead-tablefix">
                        <tr>
                            <th data-sort="id">ID <span class="sort-icon"></span></th>
                            <th data-sort="ten">Tên <span class="sort-icon"></span></th>
                            <th data-sort="thoigian">Thời gian <span class="sort-icon"></span></th>
                            <th data-sort="ngaythi">Ngày thi <span class="sort-icon"></span></th>
                            <th data-sort="giothi">Giờ thi <span class="sort-icon"></span></th>
                            <th data-sort="khoahoc">Khóa học <span class="sort-icon"></span></th>
                            <th data-sort="phanthi">Phần thi <span class="sort-icon"></span></th>
                            <th data-sort="trangthai">Trạng thái <span class="sort-icon"></span></th>
                            <th class="sticky-col" data-sort="chucnang">Chức năng <span class="sort-icon"></span></th>
                        </tr>
                        </thead>
                        <tbody id="examRows"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Bottom gray spacer to match admin sections -->
        <div class="col-sm-12 header-sp" style="min-height: 12px"></div>
    </div>
</div>
<!-- Modal: Danh sách phần thi -->
<div class="modal fade" id="phanthimodal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Danh sách phần thi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table id="lessonTable" class="table table-striped table-bordered tablefix">
          <thead>
            <tr>
              <th>ID</th>
              <th>Tên phần thi</th>
              <th>Danh mục</th>
              <th>Link file</th>
              <th>Nội dung</th>
              <th>Số câu hỏi</th>
              <th class="sticky-col">Hành động</th>
            </tr>
          </thead>
          <tbody id="listlesson"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- End Modal -->
<div id="divdoimk"></div>
<script>
// Fallback đảm bảo nav & header luôn hiển thị nếu lần đầu chưa inject
(function(){
  function ensureTeacherLayout(){
    if(typeof injectTeacherLayout === 'function'){
      var nav = document.getElementById('navleft');
      var header = document.getElementById('headerweb');
      if((nav && nav.innerHTML.trim()==='') || (header && header.innerHTML.trim()==='')){
        injectTeacherLayout();
      }
    }
  }
  // Thử lại sau 300ms
  setTimeout(ensureTeacherLayout,300);
  // Khi quay lại tab
  document.addEventListener('visibilitychange', function(){ if(!document.hidden){ ensureTeacherLayout(); } });
})();
      var header = document.getElementById('headerweb');
      if((nav && nav.innerHTML.trim()==='') || (header && header.innerHTML.trim()==='')){
        injectTeacherLayout();
      }
    }
  }
  // Thử lại sau 300ms
  setTimeout(ensureTeacherLayout,300);
  // Khi quay lại tab
  document.addEventListener('visibilitychange', function(){ if(!document.hidden){ ensureTeacherLayout(); } });
})();
</script>
</body>
</html>
